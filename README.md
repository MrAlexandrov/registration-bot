# telegram - бот для регистрации

Создан для Пионерского выезда 2025

## Запуск

Перед запуском необходимо правильно настроить `.env` файл, основываясь на `.env.example`, чтобы запустить именно своего бота.

После подготовки можно использовать следующие команды (имея установленный `make`):

`make install` - установка зависимостей

`make run` - запуск бота локально

`make docker-build` - сборка docker-образа с ботом

`make docker-run` - запуск бота в docker-окружении

`make docker-stop` - остановка бота в docker-окружении

`make docker-remove` - удаление docker-контейнера

`make docker-clean` - удаление docker-контейнера и docker-образа

## Конфигурация полей регистрации

Бот использует гибкую систему конфигурации полей через класс `SurveyField` в файле `src/registration_config.py`.

### Параметры поля

Каждое поле опроса может иметь следующие параметры:

- `field_name` - имя поля в базе данных
- `label` - метка для отображения пользователю
- `message` - текст вопроса
- `validator` - функция валидации введенных данных
- `db_formatter` - функция форматирования для сохранения в БД
- `display_formatter` - функция форматирования для отображения
- `options` - список вариантов ответов
- `multi_select` - возможность выбора нескольких вариантов
- `request_contact` - запрос контакта из Telegram
- `auto_collect` - автоматический сбор данных (например, username)
- `skip_if` - условие пропуска вопроса
- `editable` - возможность редактирования поля
- **`hidden`** - скрытие поля от отображения пользователю (по умолчанию `False`)

### Скрытие полей

Параметр `hidden=True` позволяет скрыть поле от отображения в сообщении с данными пользователя после регистрации. Это полезно для полей, которые собираются автоматически и не требуют подтверждения от пользователя.

**Пример использования:**

```python
SurveyField(
    field_name="username",
    label="Никнейм",
    auto_collect=auto_collect_username,
    editable=False,
    hidden=True,  # Поле не будет показано пользователю
)
```

В этом примере поле `username` будет автоматически собрано из данных Telegram, сохранено в базе данных, но не будет отображаться пользователю в сообщении с его данными.


# Требования

Требования, написаные мной же

## Формальные требования к системе регистрации для участия в выезде

### Общие требования
1. Регистрация участников для выезда осуществляется через Telegram-бот.
2. Система должна обеспечивать хранение данных зарегистрированных участников в соответствующем хранилище (например, файл, таблица или база данных).
3. Все взаимодействия с участниками и администраторами проходят через функционал Telegram-бота.

### Функциональные требования для участника
1. **Регистрация**:
   - Каждый участник должен иметь возможность зарегистрироваться через Telegram-бота, предоставив следующие данные:
     - ФИО (фамилия, имя, отчество);
     - дата рождения;
     - учебная группа;
     - номер телефона;
     - никнейм в Telegram;
     - другие данные (например, пожелания или ещё что-либо);
   - Система должна обеспечивать уникальность регистрации: один участник может зарегистрироваться только один раз.

2. **Редактирование данных**:
   - После регистрации участник должен иметь возможность в любой момент изменить свои данные (например, в случае ошибок при первоначальной регистрации);
   - Пользователь должен иметь возможность отменить регистрацию

3. **Подтверждение регистрации**:
   - После предоставления данных, участник должен получить уведомление или форму подтверждения (с использованием кнопок или иных элементов интерфейса Telegram-бота), потенциально, несколько раз

### Функциональные требования для администратора (организатора)
1. **Просмотр зарегистрированных участников**:
   - Администраторы должны иметь доступ к актуальному списку всех зарегистрированных участников.
   - Данный список должен содержать полную информацию о каждом участнике: ФИО, дату рождения, учебную группу, номер телефона, ник в Telegram, а также другие данные, если они имеются.

2. **Управление хранилищем данных**:
   - Администраторы должны иметь возможность просматривать и, при необходимости, экспортировать данные из хранилища.

3. **Отправка сообщений или уведомлений**:
   - Администратор должен иметь возможность отправлять сообщения одному или нескольким участником;
   - Администратор должен иметь возможность собираеть данные в сообщениях (например, с помощью inline-кнопок или запуска определённых handler'ов).

### Требования к серверу (Telegram-бот)
1. **Регистрация и обработка данных**:
   - Сервер должен обрабатывать запросы от участников на регистрацию, проверять на наличие повторной регистрации и сохранять предоставленные данные в хранилище.

2. **Обновление данных**:
   - Сервер должен позволять участникам обновлять свою информацию, перезаписывая соответствующие данные в хранилище.

3. **Уведомления и подтверждение**:
   - Сервер должен уметь отправлять уведомления или формы с подтверждающими кнопками участникам для подтверждения или изменения их данных.

4. **Управление данными участников**:
   - Сервер должен предоставлять администратору интерфейс (например, команду в Telegram-боте) для доступа к списку зарегистрированных участников.

### Требования к клиенту (участник)
1. **Регистрация через Telegram**:
   - Клиент (участник) должен зарегистрироваться с использованием Telegram-бота, предоставив свои данные, которые запрашивает бот.

2. **Редактирование данных**:
   - Клиент должен иметь возможность отправить запрос на изменение своих данных через Telegram-бота.

3. **Получение уведомлений**:
   - Клиент должен получать от Telegram-бота уведомления о регистрации, успешной модификации данных и других важных сообщениях.

### Требования к администратору
1. **Просмотр и управление данными**:
   - Администратор должен иметь возможность просматривать полный список зарегистрированных участников и управлять этим списком через Telegram-бота.

2. **Использование функционала бота**:
   - Администратор должен использовать Telegram-бота для всех операций, связанных с управлением участниками и контролем за регистрацией.
